---
layout: post
title: é˜²æŠ–å’ŒèŠ‚æµ
subtitle: å¼„æ‡‚é˜²æŠ–å’ŒèŠ‚æµå‡½æ•°çš„åŸç†
date: 2021-06-10
tags:
 - å‰ç«¯æ€§èƒ½ä¼˜åŒ–
catalog: true
header_img: /images/header-bg/21-6-10-1.gif
header_style: image
---

# å‡½æ•°çš„é˜²æŠ–å’ŒèŠ‚æµ

`é˜²æŠ–å’ŒèŠ‚æµ`æ˜¯å‰ç«¯æ—¥å¸¸å¼€å‘ä¸­éå¸¸å¸¸è§çš„ä¸€ç§æ€§èƒ½ä¼˜åŒ–çš„æ‰‹æ®µã€‚ä¸€èˆ¬ç”¨äºè§£å†³åœ¨çŸ­æ—¶é—´å†…ä¸æ–­çš„è§¦å‘äº‹ä»¶çš„å›è°ƒï¼Œå¯¼è‡´å‰ç«¯æ€§èƒ½é™ä½çš„é—®é¢˜ã€‚ä¾‹å¦‚æµè§ˆå™¨çš„inputã€mousemoveã€mouseoverã€scrollã€resizeç­‰äº‹ä»¶çš„è§¦å‘ï¼Œä¼šä¸æ–­è°ƒç”¨ç»‘å®šåœ¨äº‹ä»¶ä¸Šçš„å›è°ƒå‡½æ•°ï¼Œæå¤§çš„æµªè´¹èµ„æºã€‚ä¸ºäº†ä¼˜åŒ–ä½“éªŒï¼Œéœ€è¦å¯¹è¿™ç±»äº‹ä»¶è¿›è¡Œ`è°ƒç”¨æ¬¡æ•°çš„é™åˆ¶`

ç°åœ¨æœ‰å¾ˆå¤šå‡½æ•°åº“å·²ç»å¸®åŠ©æˆ‘ä»¬å°è£…äº†é˜²æŠ–å’ŒèŠ‚æµå‡½æ•°æ¯”å¦‚Lodashä¸­çš„`_.debounceå’Œ_.throttle`ï¼Œä»Šå¤©åœ¨è¿™ç¯‡æ–‡ç« ä¸­å°±æ¥æ·±å…¥äº†è§£ä¸€ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•çš„åŸç†ã€‚

![Personal Website with React - Implementing Throttle and Debounce Functions  to Limit Window Events - YouTube](https://i.ytimg.com/vi/wyyOhF9lrgc/maxresdefault.jpg)



## ä¸€ã€ä»€ä¹ˆæ˜¯é˜²æŠ–å’ŒèŠ‚æµ

---

<img src="https://jools.dev/images/throttle-debounce.gif" alt="Debounce and Throttle Functions in JavaScript" style="zoom:80%;" /> 



- é˜²æŠ–(debounce)ï¼šå°±æ˜¯æŒ‡è§¦å‘äº‹ä»¶åï¼Œåœ¨ n ç§’ååªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœåœ¨ n ç§’å†…åˆè§¦å‘äº†äº‹ä»¶ï¼Œåˆ™ä¼šé‡æ–°è®¡ç®—å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ã€‚`ç®€å•çš„è¯´ï¼Œå½“ä¸€ä¸ªåŠ¨ä½œè¿ç»­è§¦å‘ï¼Œåªæ‰§è¡Œæœ€åä¸€æ¬¡ã€‚`

- èŠ‚æµ(throttle)ï¼šé™åˆ¶ä¸€ä¸ªå‡½æ•°åœ¨ä¸€å®šæ—¶é—´å†…åªèƒ½æ‰§è¡Œä¸€æ¬¡

ä»¥ä¸Šä¸¤ä¸ªæ¦‚å¿µå¯ä»¥ç”¨ç°å®ç”Ÿæ´»ä¸­çš„æƒ…å†µæ¥ä¸¾ä¾‹ï¼Œå¸®åŠ©æ›´å¥½çš„ç†è§£ã€‚ç”¨å¸æœºç­‰å¾…ä¹˜å®¢æ¥æ‰“ä¸ªæ¯”æ–¹ğŸšŒ

- é˜²æŠ–å°±å¥½æ¯”ï¼Œå…¬äº¤è½¦å¸æœºæ¯æ¬¡åˆ°ç«™æ—¶éœ€è¦ç­‰å¾…æœ€åä¸€ä¸ªä¹˜å®¢è¿›å…¥æ‰ä¼šå…³é—¨å¼€å¾€ä¸‹ä¸€ç«™ã€‚æ¯æ¬¡è¿›æ¥ä¸€ä¸ªäººåï¼Œå¸æœºå°±ä¼šå¤šç­‰å‡ ç§’é’Ÿï¼Œå¦‚æœæ²¡æœ‰äººå†ä¸Šè½¦åå†å…³é—¨ã€‚
- èŠ‚æµå°±å¥½æ¯”ï¼Œä¹˜ååœ°é“æ—¶ï¼Œæ¯æ¬¡åˆ°ç«™æ—¶éƒ½æœ‰è§„å®šçš„ç­‰å¾…ä¹˜å®¢è¿›å…¥çš„æ—¶é—´ï¼Œæ—¶é—´ä¸€åˆ°å°±ä¼šå…³é—­è½¦é—¨å¼€å¾€ä¸‹ä¸€ç«™ã€‚



## äºŒã€å¸¸è§çš„åº”ç”¨åœºæ™¯

---

### 1. é˜²æŠ–å‡½æ•°(debounce)çš„åº”ç”¨åœºæ™¯

è¿ç»­çš„äº‹ä»¶ï¼Œåªéœ€è§¦å‘ä¸€æ¬¡çš„å›è°ƒåœºæ™¯æœ‰ï¼š

- æœç´¢æ¡†æœç´¢è¾“å…¥ã€‚åªéœ€è¦ç”¨æˆ·æœ€åä¸€æ¬¡è¾“å…¥å®Œå†å‘é€è¯·æ±‚
- æ‰‹æœºå·ã€é‚®ç®±æ ¼å¼çš„è¾“å…¥éªŒè¯æ£€æµ‹
- çª—å£å¤§å°çš„ resize ã€‚åªéœ€çª—å£è°ƒæ•´å®Œæˆåï¼Œè®¡ç®—çª—å£çš„å¤§å°ï¼Œé˜²æ­¢é‡å¤æ¸²æŸ“ã€‚

### 2. å‡½æ•°èŠ‚æµï¼ˆthrottleï¼‰çš„åº”ç”¨åœºæ™¯

é—´éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œä¸€æ¬¡å›è°ƒçš„åœºæ™¯æœ‰ï¼š

- æ»šåŠ¨åŠ è½½ï¼ŒåŠ è½½æ›´å¤šæˆ–æ»šåŠ¨åˆ°åº•éƒ¨ç›‘å¬
- è°·æ­Œæœç´¢æ¡†ï¼Œæœç´¢è”æƒ³åŠŸèƒ½
- é«˜é¢‘ç‚¹å‡»æäº¤ï¼Œè¡¨å•é‡å¤æäº¤
- çœå¸‚ä¿¡æ¯å¯¹åº”å­—æ¯å¿«é€Ÿé€‰æ‹©



## ä¸‰ã€é˜²æŠ–å’ŒèŠ‚æµçš„ä»£ç å®ç°

---

### 1. é˜²æŠ– (debounce)

è™½ç„¶é˜²æŠ–çš„æ€è·¯å¾ˆå¥½ç†è§£,ä½†æ˜¯åœ¨å°è£…è¯¥åŠŸèƒ½å‡½æ•°çš„æ—¶å€™,ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚æ‰€ä»¥ä¸€æ­¥æ­¥çš„å®Œå–„é˜²æŠ–å‡½æ•°ã€‚

#### ç¬¬ä¸€ç‰ˆï¼ˆç®€æ˜“ç‰ˆæœ¬ï¼‰

åˆ›å»ºä¸€ä¸ªtimerå˜é‡ï¼Œç”¨æ¥è®°å½•å½“å‰åˆ›å»ºçš„å®šæ—¶å™¨ç¼–å·ï¼Œæ¯æ¬¡å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå…ˆä¼šå»åˆ¤æ–­æœ‰æ— å®šæ—¶å™¨ï¼Œå¦‚æœæœ‰å°±ä¼šæ¸…é™¤ä¹‹å‰åˆ›å»ºçš„å®šæ—¶å™¨ï¼Œå†é‡æ–°åˆ›å»ºå®šæ—¶å™¨ï¼Œå¦‚æœåœ¨è®¾å®šçš„æ—¶é—´é—´éš”(wait)å†…æ²¡æœ‰é‡æ–°è§¦å‘è¯¥å‡½æ•°ï¼Œåˆ™æ‰§è¡Œå®šæ—¶å™¨å†…éƒ¨çš„å›è°ƒã€‚

```javascript
function debounce(fn, wait) {
    // timeråœ¨é—­åŒ…ä¸­ï¼Œä¸ä¼šéšç€å‡½æ•°è°ƒç”¨çš„ç»“æŸåœ¨å†…å­˜ä¸­é”€æ¯
    var timer
    return function() {
        if (timer) {
            clearTimeout(timer)
        }
        timer = setTimeout(fn, wait)
    }
}
```

åœ¨è¿è¡Œæµ‹è¯•ä¹‹åï¼Œå‘ç°è¿˜æ˜¯æœ‰ä¸€äº›é—®é¢˜çš„ã€‚ä¼ å…¥debounceå†…éƒ¨çš„å‡½æ•°çš„thisæŒ‡å‘windowï¼Œä½†æ˜¯åšä¸ºäº‹ä»¶çš„å›è°ƒï¼Œè¯¥å‡½æ•°çš„thisåº”è¯¥æŒ‡å‘è§¦å‘äº‹ä»¶çš„å…ƒç´ å¯¹è±¡ã€‚ä¸‹é¢ä¸€ä¸ªç‰ˆæœ¬ç”¨æ¥ä¼˜åŒ–è¯¥é—®é¢˜ã€‚

#### ç‰ˆæœ¬äºŒï¼ˆè§£å†³thisæŒ‡å‘é—®é¢˜ï¼‰

- ç”¨ç®­å¤´å‡½æ•°è§£å†³thisæŒ‡å‘é—®é¢˜ï¼Œå› ä¸ºç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„thisï¼Œæ‰€ä»¥ä¼šæ²¿ç€ä½œç”¨åŸŸé“¾å‘ä¸Šå±‚å¯»æ‰¾thisã€‚ä¹Ÿå°±æ˜¯debounceå‡½æ•°å†…éƒ¨è¿”å›çš„å‡½æ•°å¯¹è±¡çš„thisï¼Œè¯¥thisæŒ‡å‘å°±æ˜¯è§¦å‘äº‹ä»¶çš„å…ƒç´ å¯¹è±¡ã€‚

```javascript
function debounce(fn, wait) {
    let timer
    return function() {
        if (timer) clearTimeout(timer)
        timer = setTimeout(() => {
            fn()
        }, wait)
    }
}
```

- ç”¨applyæ”¹å˜thisæŒ‡å‘

```javascript
function debounce(fn, wait) {
    var timer
    return function() {
        var that = this
        if (timer) clearTimeout(timer)
        timer = setTimeout(function() {
            fn.apply(that)
        }, wait)
    }
}
```

ç°åœ¨å·²ç»è§£å†³äº†ç®­å¤´å‡½æ•°çš„é—®é¢˜ï¼Œä½†æ˜¯fnå¯èƒ½æ˜¯æºå¸¦å‚æ•°çš„ï¼Œæ¯”å¦‚å¯èƒ½ä¼šä¼ å…¥äº‹ä»¶å¯¹è±¡eventã€‚å¯¹æ¬¡å†æ¬¡è¿›è¡Œä¼˜åŒ–

#### ç‰ˆæœ¬ä¸‰ï¼ˆè§£å†³å‚æ•°é—®é¢˜ï¼‰

```javascript
function debounce(fn, wait) {
    var timer
    return function() {
        var that = this
        var args = arguments
        if (timer) clearTimeout(timer)
        timer = setTimeout(function() {
            fn.apply(that, args)
        }, wait)
    }
}
```

åŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨ç®­å¤´å‡½æ•°æ¥æ”¹å†™è¯¥å‡½æ•°

```javascript
function debounce(fn, wait) {
    let timer 
    return function() {
       if (timer) clearTimeout(timer)
       timer = setTimeout(function() {
           fn(this, arguments)
       }, wait)      
    }
}
```

#### ç‰ˆæœ¬å››ï¼ˆä¼˜åŒ–åŠŸèƒ½ï¼‰

åœ¨çœŸå®çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šåœ¨äº‹ä»¶çš„å›è°ƒä¸­å¤„ç†ä¸€äº›å¼‚æ­¥çš„ç½‘ç»œè¯·æ±‚ã€‚ä½†æ˜¯ç½‘ç»œé€Ÿåº¦æœ‰å¿«æœ‰æ…¢ï¼Œå½“ç½‘ç»œé€Ÿåº¦è¾ƒæ…¢çš„æƒ…å†µä¸‹ï¼Œä¸ºäº†ä¼˜åŒ–ç”¨æˆ·çš„ä½“éªŒï¼Œä¼šæœ‰ç¬¬ä¸€æ¬¡è§¦å‘äº‹ä»¶å›è°ƒæ—¶ä¸å»ç”¨é˜²æŠ–å‡½æ•°é™åˆ¶å…¶æ‰§è¡Œçš„éœ€æ±‚ã€‚

é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå¯ä»¥åœ¨debounceçš„å†…éƒ¨å†æ·»åŠ ä¸€ä¸ªå‚æ•°triggerNowç”¨æ¥åˆ¤æ–­æ˜¯å¦åœ¨ç¬¬ä¸€æ¬¡è§¦å‘ç«‹å³æ‰§è¡Œ

```javascript
function debounce(fn, wait, triggerNow) {
    let timer
    return function() {
        if (timer) clearTimeout(timer)
        if (triggerNow) {
            let fristTrigger = !timer
            // åˆ¤æ–­æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡è§¦å‘
            if (fristTrigger) {
                fn.apply(this, arguments)
            }     
            timer = setTimeout(() => {
                timer = null
            }, wait)
        } else {
            timer = setTimeout(() => {
                fn.apply(this, arguments)
            }, wait)
        }
    }
}
```

è¿™æ ·å°±å¾—åˆ°äº†ä¸€ä¸ªåŠŸèƒ½è¾ƒä¸ºå®Œå–„çš„é˜²æŠ–å‡½æ•°äº†ï¼Œå…¶å®åŠŸèƒ½è¿˜å¯ä»¥è¿›ä¸€æ­¥çš„è¿›è¡Œä¼˜åŒ–ã€‚

#### æµ‹è¯•

è¿™é‡Œæˆ‘ç”¨inputæ¡†çš„è¾“å…¥æ¥æµ‹è¯•é˜²æŠ–å‡½æ•°

```javascript
function testFunc() {
    console.log(arguments) // å¯ä»¥ç”¨å…¶æµ‹è¯•ä¼ é€’å‚æ•°é—®é¢˜
    console.log(this)  // å¯ä»¥ç”¨å…¶æµ‹è¯•thisæŒ‡å‘é—®é¢˜
}
// ç»‘å®šç›‘å¬
input.addEventListener('input', debounce(testFunc, 3000, true))
```



### 2. èŠ‚æµ ï¼ˆthrottleï¼‰

å‡½æ•°èŠ‚æµç›¸è¾ƒäºé˜²æŠ–è¦æ›´å¥½ç†è§£ä¸€äº›ï¼Œå°±æ˜¯åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…åªæ‰§è¡Œä¸€æ¬¡å‡½æ•°ã€‚å®ƒçš„å®ç°é€»è¾‘ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå¯ä»¥åˆ©ç”¨æ—¶é—´æˆ³æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å®šæ—¶å™¨æ¥å®ç°ã€‚

#### æ—¶é—´æˆ³ç‰ˆæœ¬

ä½¿ç”¨æ—¶é—´æˆ³æ¥è®°å½•äº‹ä»¶è§¦å‘çš„æ—¶é—´ã€‚å½“äº‹ä»¶è§¦å‘çš„æ—¶å€™å–å‡ºå½“å‰çš„æ—¶é—´æˆ³å‡å»ä¸Šä¸€æ¬¡è§¦å‘çš„æ—¶é—´æˆ³ã€‚å¦‚æœå¤§äºæ—¢å®šçš„æ—¶é—´é—´éš”åˆ™æ‰§è¡Œå‡½æ•°ï¼Œç„¶åæ›´æ–°æ—¶é—´æˆ³ã€‚

```javascript
function throttle(fn, wait) {
    let begin = 0
    return function() {
        let cur = new Date().getTime()
        if (cur - begin > wait) {
            fn.apply(this, arguments)
            begin = cur
        }
    }
}
```

#### å®šæ—¶å™¨ç‰ˆæœ¬

å½“è§¦å‘äº‹ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå†è§¦å‘äº‹ä»¶çš„æ—¶å€™ï¼Œå¦‚æœå®šæ—¶å™¨å­˜åœ¨ï¼Œå°±ä¸æ‰§è¡Œï¼Œç›´åˆ°å®šæ—¶å™¨æ‰§è¡Œï¼Œç„¶åæ‰§è¡Œå‡½æ•°ï¼Œæ¸…ç©ºå®šæ—¶å™¨ï¼Œè¿™æ ·å°±å¯ä»¥è®¾ç½®ä¸‹ä¸ªå®šæ—¶å™¨

```javascript
function throttle(fn, wait) {
    let timer
    return function() {
        if (!timer) {
        	timer = setTimeout(() => {
                fn.apply(this, arguments)
                timer = null
            }, wait)   
        }
    }
}
```



## å‚è€ƒèµ„æ–™é“¾æ¥

---

[å‡½æ•°çš„é˜²æŠ–å’ŒèŠ‚æµ -- JS åŸç”Ÿé¢è¯•é¢˜](https://www.bilibili.com/video/BV1Vy4y1y7tj?p=3)

[å½»åº•å¼„æ‡‚å‡½æ•°é˜²æŠ–å’Œå‡½æ•°èŠ‚æµ](https://segmentfault.com/a/1190000018445196)

[å‰ç«¯æ€§èƒ½ä¼˜åŒ–-é˜²æŠ–å’ŒèŠ‚æµ](https://www.bilibili.com/read/cv12048093)

